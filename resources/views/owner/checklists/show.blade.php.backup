@extends('layouts.app')

@section('content')
<div class="container-fluid px-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card border-0 shadow-lg" style="background: var(--primary-gradient); border-radius: 20px;">
                <div class="card-body py-4 px-5">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="text-white mb-2 fw-bold" style="font-size: 2rem;">
                                <i class="bi bi-clipboard-check-fill me-2"></i>Assignment Details
                            </h1>
                            <p class="text-white mb-0" style="opacity: 0.9;">
                                <i class="bi bi-calendar-event me-2"></i>Scheduled: {{ $checklist->scheduled_date->format('F d, Y') }}
                                @if($checklist->scheduled_time)
                                    <span class="ms-2"><i class="bi bi-clock me-1"></i>{{ date('g:i A', strtotime($checklist->scheduled_time)) }}</span>
                                @endif
                            </p>
                        </div>
                        <div>
                            <a href="{{ route('owner.checklists.index') }}" class="btn btn-light btn-lg me-2" style="border-radius: 12px; font-weight: 600;">
                                <i class="bi bi-arrow-left-circle"></i> Back to Assignments
                            </a>
                            <button type="button" class="btn btn-danger btn-lg" data-bs-toggle="modal" data-bs-target="#deleteModal" style="border-radius: 12px; font-weight: 600;">
                                <i class="bi bi-trash-fill"></i> Delete Assignment
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Badge -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="alert border-0 shadow-lg" style="border-radius: 15px; 
                @if($checklist->status === 'completed')
                    background: linear-gradient(135deg, rgba(17, 153, 142, 0.2) 0%, rgba(56, 239, 125, 0.2) 100%);
                @elseif($checklist->status === 'in_progress')
                    background: linear-gradient(135deg, rgba(79, 172, 254, 0.2) 0%, rgba(0, 242, 254, 0.2) 100%);
                @else
                    background: linear-gradient(135deg, rgba(246, 211, 101, 0.2) 0%, rgba(253, 160, 133, 0.2) 100%);
                @endif
            ">
                <div class="d-flex align-items-center">
                    <div class="badge rounded-circle p-3 me-3" style="
                        @if($checklist->status === 'completed')
                            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
                        @elseif($checklist->status === 'in_progress')
                            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
                        @else
                            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
                        @endif
                        width: 60px; height: 60px; display: flex; align-items: center; justify-content: center;">
                        <i class="bi 
                            @if($checklist->status === 'completed') bi-check-circle-fill
                            @elseif($checklist->status === 'in_progress') bi-play-circle-fill
                            @else bi-hourglass
                            @endif
                        text-white" style="font-size: 1.8rem;"></i>
                    </div>
                    <div>
                        <h4 class="mb-1 fw-bold">Status: {{ ucfirst(str_replace('_', ' ', $checklist->status)) }}</h4>
                        @if($checklist->completed_at)
                            <p class="mb-0"><i class="bi bi-clock-fill me-1"></i>Completed: {{ $checklist->completed_at->format('M d, Y g:i A') }}</p>
                        @elseif($checklist->started_at)
                            <p class="mb-0"><i class="bi bi-clock-fill me-1"></i>Started: {{ $checklist->started_at->format('M d, Y g:i A') }}</p>
                        @endif
                    </div>
                </div>
            </alert>
        </div>
    </div>

    <!-- Assignment Info -->
    <div class="row g-4 mb-4">
        <div class="col-md-6">
            <div class="card border-0 shadow-lg" style="border-radius: 20px;">
                <div class="card-header border-0 py-3" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%); border-radius: 20px 20px 0 0;">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-building me-2"></i>Property Information</h5>
                </div>
                <div class="card-body p-4">
                    <table class="table table-borderless" style="font-size: 1.05rem;">
                        <tr>
                            <td class="text-muted" style="width: 40%;"><i class="bi bi-building me-2"></i>Property:</td>
                            <td class="fw-bold">{{ $checklist->property->name }}</td>
                        </tr>
                        <tr>
                            <td class="text-muted"><i class="bi bi-geo-alt me-2"></i>Address:</td>
                            <td>{{ $checklist->property->address }}</td>
                        </tr>
                        @if($checklist->room)
                        <tr>
                            <td class="text-muted"><i class="bi bi-door-closed me-2"></i>Room:</td>
                            <td class="fw-bold">{{ $checklist->room->name }}</td>
                        </tr>
                        @endif
                    </table>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card border-0 shadow-lg" style="border-radius: 20px;">
                <div class="card-header border-0 py-3" style="background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%); border-radius: 20px 20px 0 0;">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-person-badge me-2"></i>Housekeeper Information</h5>
                </div>
                <div class="card-body p-4">
                    <table class="table table-borderless" style="font-size: 1.05rem;">
                        <tr>
                            <td class="text-muted" style="width: 40%;"><i class="bi bi-person me-2"></i>Name:</td>
                            <td class="fw-bold">{{ $checklist->housekeeper->name }}</td>
                        </tr>
                        <tr>
                            <td class="text-muted"><i class="bi bi-envelope me-2"></i>Email:</td>
                            <td>{{ $checklist->housekeeper->email }}</td>
                        </tr>
                        <tr>
                            <td class="text-muted"><i class="bi bi-telephone me-2"></i>Phone:</td>
                            <td>{{ $checklist->housekeeper->phone ?? 'N/A' }}</td>
                        </tr>
                        @if($checklist->gps_verified)
                        <tr>
                            <td class="text-muted"><i class="bi bi-geo-alt-fill me-2"></i>GPS:</td>
                            <td><span class="badge bg-success"><i class="bi bi-check-circle-fill"></i> Verified</span></td>
                        </tr>
                        @endif
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Tasks List -->
    @if($checklist->checklistItems && $checklist->checklistItems->count() > 0)
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card border-0 shadow-lg" style="border-radius: 20px;">
                <div class="card-header border-0 py-3" style="background: linear-gradient(135deg, rgba(17, 153, 142, 0.1) 0%, rgba(56, 239, 125, 0.1) 100%); border-radius: 20px 20px 0 0;">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-list-check me-2"></i>Cleaning Tasks ({{ $checklist->checklistItems->count() }})</h5>
                </div>
                <div class="card-body p-4">
                    <div class="table-responsive">
                        <table class="table table-hover" style="font-size: 1rem;">
                            <thead style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);">
                                <tr>
                                    <th class="py-3" style="border-radius: 12px 0 0 12px;">Task</th>
                                    <th class="py-3">Description</th>
                                    <th class="py-3 text-center">Status</th>
                                    <th class="py-3 text-center" style="border-radius: 0 12px 12px 0;">Completed At</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach($checklist->checklistItems as $item)
                                <tr>
                                    <td class="fw-bold">
                                        @if($item->is_completed)
                                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                                        @else
                                            <i class="bi bi-circle text-muted me-2"></i>
                                        @endif
                                        {{ $item->task->name }}
                                    </td>
                                    <td class="text-muted">{{ $item->task->description ?? 'N/A' }}</td>
                                    <td class="text-center">
                                        @if($item->is_completed)
                                            <span class="badge bg-success px-3 py-2" style="border-radius: 10px;">
                                                <i class="bi bi-check-circle"></i> Completed
                                            </span>
                                        @else
                                            <span class="badge bg-secondary px-3 py-2" style="border-radius: 10px;">
                                                <i class="bi bi-circle"></i> Pending
                                            </span>
                                        @endif
                                    </td>
                                    <td class="text-center">
                                        {{ $item->completed_at ? $item->completed_at->format('M d, g:i A') : '-' }}
                                    </td>
                                </tr>
                                @endforeach
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @endif

    <!-- Inventory Items -->
    @if($checklist->inventoryItems && $checklist->inventoryItems->count() > 0)
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card border-0 shadow-lg" style="border-radius: 20px;">
                <div class="card-header border-0 py-3" style="background: linear-gradient(135deg, rgba(246, 211, 101, 0.1) 0%, rgba(253, 160, 133, 0.1) 100%); border-radius: 20px 20px 0 0;">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-box-seam me-2"></i>Inventory Checked ({{ $checklist->inventoryItems->count() }})</h5>
                </div>
                <div class="card-body p-4">
                    <div class="table-responsive">
                        <table class="table table-hover" style="font-size: 1rem;">
                            <thead style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);">
                                <tr>
                                    <th class="py-3" style="border-radius: 12px 0 0 12px;">Item Name</th>
                                    <th class="py-3 text-center">Quantity</th>
                                    <th class="py-3 text-center">Condition</th>
                                    <th class="py-3" style="border-radius: 0 12px 12px 0;">Notes</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach($checklist->inventoryItems as $item)
                                <tr>
                                    <td class="fw-bold">
                                        <i class="bi bi-box text-primary me-2"></i>
                                        {{ $item->item_name }}
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-primary px-3 py-2" style="border-radius: 10px;">
                                            {{ $item->quantity }}
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        @if($item->condition === 'good')
                                            <span class="badge bg-success px-3 py-2" style="border-radius: 10px;">
                                                <i class="bi bi-check-circle"></i> Good
                                            </span>
                                        @elseif($item->condition === 'damaged')
                                            <span class="badge bg-danger px-3 py-2" style="border-radius: 10px;">
                                                <i class="bi bi-exclamation-triangle"></i> Damaged
                                            </span>
                                        @else
                                            <span class="badge bg-warning px-3 py-2" style="border-radius: 10px;">
                                                <i class="bi bi-exclamation-circle"></i> Missing
                                            </span>
                                        @endif
                                    </td>
                                    <td class="text-muted">{{ $item->notes ?? '-' }}</td>
                                </tr>
                                @endforeach
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @endif

    <!-- Photos -->
    @if($checklist->photos && $checklist->photos->count() > 0)
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card border-0 shadow-lg" style="border-radius: 20px;">
                <div class="card-header border-0 py-3" style="background: linear-gradient(135deg, rgba(79, 172, 254, 0.1) 0%, rgba(0, 242, 254, 0.1) 100%); border-radius: 20px 20px 0 0;">
                    <h5 class="mb-0 fw-bold"><i class="bi bi-camera-fill me-2"></i>Photos Uploaded ({{ $checklist->photos->count() }})</h5>
                </div>
                <div class="card-body p-4">
                    <div class="row g-4">
                        @foreach($checklist->photos as $photo)
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm h-100" style="border-radius: 15px; overflow: hidden;">
                                <div style="height: 200px; overflow: hidden; background: #f8f9fa;">
                                    <img src="{{ asset('storage/' . $photo->file_path) }}" 
                                         alt="Photo" 
                                         class="w-100 h-100" 
                                         style="object-fit: cover; cursor: pointer;"
                                         data-bs-toggle="modal" 
                                         data-bs-target="#photoModal{{ $photo->id }}">
                                </div>
                                @if($photo->room)
                                <div class="card-body p-2 text-center">
                                    <small class="text-muted">
                                        <i class="bi bi-door-closed me-1"></i>{{ $photo->room->name }}
                                    </small>
                                </div>
                                @endif
                            </div>
                        </div>

                        <!-- Photo Modal -->
                        <div class="modal fade" id="photoModal{{ $photo->id }}" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-lg">
                                <div class="modal-content border-0" style="border-radius: 20px;">
                                    <div class="modal-header border-0">
                                        <h5 class="modal-title">
                                            <i class="bi bi-image me-2"></i>Photo Details
                                        </h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                    </div>
                                    <div class="modal-body p-0">
                                        <img src="{{ asset('storage/' . $photo->file_path) }}" 
                                             alt="Photo" 
                                             class="w-100" 
                                             style="border-radius: 0 0 20px 20px;">
                                    </div>
                                    @if($photo->room)
                                    <div class="modal-footer border-0">
                                        <p class="mb-0 text-muted">
                                            <i class="bi bi-door-closed me-1"></i>Room: {{ $photo->room->name }}
                                        </p>
                                    </div>
                                    @endif
                                </div>
                            </div>
                        </div>
                        @endforeach
                    </div>
                </div>
            </div>
        </div>
    </div>
    @endif
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
            <div class="modal-header border-0 bg-danger text-white" style="border-radius: 20px 20px 0 0;">
                <h5 class="modal-title fw-bold" id="deleteModalLabel">
                    <i class="bi bi-exclamation-triangle-fill me-2"></i>Delete Assignment
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <p class="mb-0 fs-5">Are you sure you want to delete this assignment?</p>
                <p class="text-muted mt-2 mb-0">This action cannot be undone. All task completion data will be permanently deleted.</p>
            </div>
            <div class="modal-footer border-0 p-4">
                <button type="button" class="btn btn-outline-secondary px-4" data-bs-dismiss="modal" style="border-radius: 12px; font-weight: 600;">
                    <i class="bi bi-x-circle me-1"></i>Cancel
                </button>
                <form action="{{ route('owner.checklists.destroy', $checklist) }}" method="POST" class="d-inline">
                    @csrf
                    @method('DELETE')
                    <button type="submit" class="btn btn-danger px-4" style="border-radius: 12px; font-weight: 600;">
                        <i class="bi bi-trash-fill me-1"></i>Yes, Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
@endsection
